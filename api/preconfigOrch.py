"""
**********************************************************

This module uploads preconfiguration files to 
Orchestrator.

**********************************************************
"""

def preconfigUpload(orchIP, loginCookie, name, tag, data):
    import requests
    import sys

# Surpress ssl certificate verifcation warnings

    requests.packages.urllib3.disable_warnings()

# API call

    url = "https://{0}/gms/rest/gms/appliance/preconfiguration".format(orchIP)
    payload = "{{\r\n  \"name\": \"{0}\",\r\n  \"serialNum\": null,\r\n  \"tag\": \"{1}\",\r\n  \"comment\": null,\r\n  \"autoApply\": true,\r\n  \"configData\": \"{2}\"\r\n}}".format(name, tag, data)
    headers = {'Content-Type': 'application/json'}
    response = requests.request("POST", url, headers=headers, data=payload, cookies=loginCookie, verify=False)

    if response.status_code == 200:
        print(name + ' preconfiguration successfully uploaded to Orchestrator.')
    else:
        sys.exit('Failed to upload ' + name + ' preconfiuration to Orchestrator.')


"""
********************************************************************************
For Testing Only
********************************************************************************
"""

if __name__ == "__main__":

    print('\n ****************************************************************')
    print('\n    This module was ran directly. It is for testing only.')
    print('\n **************************************************************** \n')

    from login import OrchLogin
    orchIP = input("Orchestrator IP Address: ")
    user = input("username: ")
    password = input("password: ")

    loginCookie = OrchLogin(orchIP, user, password)

    name = 'ecv1-test'
    tag = 'ecv1-tag'
    
    # data has already been converted to base64 for upload to Orchestrator
    data = 'IyBQcmVjb25maWd1cmF0aW9uIFRlbXBsYXRlIGZvciBBcHBsaWFuY2UgU2V0dXAKIyBJZiBhbnkgZmllbGRzIGFyZW4ndCBuZWVkZWQgdGhlbiByZW1vdmUgdGhlbS4KICAjIHNvZnR3YXJlVmVyc2lvbiAtIFZlcnNpb24gb2YgdGhlIHNvZnR3YXJlIHRvIHVwZ3JhZGUgdGhlIGFwcGxpYW5jZSB0bywKICAjICAgICAgICAgICAgICAgICAgIHRoaXMgd2lsbCBoYXBwZW4gYmVmb3JlIHRoZSByZXN0IG9mIHRoZSBwcmVjb25maWd1cmF0aW9uCiAgIyAgICAgICAgICAgICAgICAgICBpcyBhcHBsaWVkLiBUaGUgdmFsaWQgdmVyc2lvbnMgdG8gdXNlIGNhbiBiZSBzZWVuIGluIHRoZQogICMgICAgICAgICAgICAgICAgICAgIkFwcGxpYW5jZSBVcGdyYWRlIiBkaWFsb2cgaW4gT3JjaGVzdHJhdG9yCiAgIyAgICAgICAgICAgICAgICAgICBWYWx1ZTogc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBzb2Z0d2FyZSB2ZXJzaW9uLgogICMgICAgICAgICAgICAgICAgICAgICAgICAgIGV4OiAiOC40LjAuMF8xMjM0NSIKICAjIGhvc3RuYW1lICAgIC0gICAgIEhvc3RuYW1lIHRvIHNldCBmb3IgdGhpcyBhcHBsaWFuY2UKICAjICAgICAgICAgICAgICAgICAgIFZhbHVlOiBzdHJpbmcgd2l0aCBtYXhpbXVtIDYwIGNoYXJhY3RlcnMsIG9wdGlvbmFsCiAgIyBncm91cCAtICAgICAgICAgIFRoZSBncm91cCBpbiB0aGUgT3JjaGVzdHJhdG9yIHRyZWUgaW50byB3aGljaAogICMgICAgICAgICAgICAgICAgICB0aGlzIGFwcGxpYW5jZSBzaG91bGQgYmUgYWRkZWQKICAjICAgICAgICAgICAgICAgICAgVmFsdWU6IE9yY2hlc3RyYXRvciB0cmVlIGdyb3VwIG5hbWUsIHJlcXVpcmVkCiAgIyBzaXRlICAtICAgICAgIE5hbWUgb2YgdGhlIHNpdGUgd2hlcmUgdGhpcyBhcHBsaWFuY2UgcmVzaWRlcy4KICAjICAgICAgICAgICAgICAgU2l0ZSBuYW1lIGlzIG1haW5seSB1c2VkIHRvIHByZXZlbnQgdHVubmVscyBmcm9tIGJlaW5nIGJ1aWx0CiAgIyAgICAgICAgICAgICAgIGJldHdlZW4gYXBwbGlhbmNlcyB3aXRoIHRoZSBzYW1lIHNpdGUgbmFtZQogICMgICAgICAgICAgICAgICBWYWx1ZTogYW55IHN0cmluZywgb3B0aW9uYWwsIGRlZmF1bHQgZW1wdHkKICAjCiAgIyBuZXR3b3JrUm9sZSAtIFJvbGUgdGhhdCBhcHBsaWFuY2UgcGxheXMgaW4gdGhlIG5ldHdvcmssIHNwZWNpZmljYWxseQogICMgICAgICAgICAgICAgIHR1bm5lbCB0b3BvbG9neS4gQXBwbGlhbmNlcyBkZXNpZ25hdGVkIGFzICJodWIicyBjYW4gc2VydmUKICAjICAgICAgICAgICAgICBhcyBodWJzIGluIGFuIG92ZXJsYXkgdG9wb2xvZ3kuIEFwcGxpYW5jZXMgZGVzaWduYXRlZCBhcwogICMgICAgICAgICAgICAgICJub24taHViInMgY2Fubm90IHNlcnZlIGFzIGh1YnMgaW4gYW4gb3ZlcmxheSB0b3BvbG9neS4KICAjICAgICAgICAgICAgICBWYWx1ZTogIm5vbi1odWIiLCAiaHViIi4gcmVxdWlyZWQKICAjCiAgIyByZWdpb24gLSAgICAgICBSZWdpb24gdG8gd2hpY2ggYXBwbGlhbmNlIGJlbG9uZ3MsIGlmIGFwcGxpY2FibGUuCiAgIyAgICAgICAgICAgICAgICBUaGlzIGFwcGxpZXMgd2hlbiBjb25maWd1cmluZyBhIG11bHRpLXJlZ2lvbgogICMgICAgICAgICAgICAgICAgdG9wb2xvZ3kgZm9yIHRoZSBTRC1XQU4uCiAgIyAgICAgICAgICAgICAgICBWYWx1ZTogdmFsaWQgcmVnaW9uIG5hbWUsIG9wdGlvbmFsLCBkZWZhdWx0IHdpdGhvdXQgcmVnaW9uCiAgIwogICMgbG9jYXRpb24gLSAgICBMb2NhdGlvbiBpbmZvcm1hdGlvbiBhc3NvY2lhdGVkIHdpdGggZGVwbG95ZWQgYXBwbGlhbmNlLgogICMgICAgICAgICAgICAgICBUaGVzZSBhcmUgcHV0IGludG8gdGhlIGFwcGxpYW5jZSBTTk1QIGNvbmZpZ3VyYXRpb24uCiAgIyAgICAgICAgICAgICAgIFRoaXMgc2VjdGlvbiBpcyByZXF1aXJlZC4KICAjICAgICAgICAgICAgICAgTG9jYXRpb24gY29tcHJpc2VzIHRoZSBmb2xsb3dpbmcga2V5L3ZhbHVlIHBhaXJzOgogICMgICBhZGRyZXNzIC0gICBBZGRyZXNzIDEKICAjICAgICAgICAgICAgICAgICBWYWx1ZTogYW55IHN0cmluZywgb3B0aW9uYWwsIGRlZmF1bHQgZW1wdHkKICAjICAgYWRkcmVzczIgLSAgQWRkcmVzcyAyCiAgIyAgICAgICAgICAgICAgICAgVmFsdWU6IGFueSBzdHJpbmcsIG9wdGlvbmFsLCBkZWZhdWx0IGVtcHR5CiAgIyAgIGNpdHkgICAgLSAgIENpdHkKICAjICAgICAgICAgICAgICAgICBWYWx1ZTogYW55IHN0cmluZywgb3B0aW9uYWwsIGRlZmF1bHQgZW1wdHkKICAjICAgc3RhdGUgICAtICAgU3RhdGUKICAjICAgICAgICAgICAgICAgICBWYWx1ZTogYW55IHN0cmluZywgb3B0aW9uYWwsIGRlZmF1bHQgZW1wdHkKICAjICAgemlwQ29kZSAtICAgWmlwIENvZGUKICAjICAgICAgICAgICAgICAgICBWYWx1ZTogYW55IHN0cmluZywgb3B0aW9uYWwsIGRlZmF1bHQgZW1wdHkKICAjICAgY291bnRyeSAtICAgQ291bnRyeQogICMgICAgICAgICAgICAgICAgIFZhbHVlOiBhbnkgc3J0aW5nLCBvcHRpb25hbCwgZGVmYXVsdCBlbXB0eQogICMKICAjICAgbGF0aXR1ZGUgLSAgTGF0aXR1ZGUKICAjICAgICAgICAgICAgICAgICBWYWx1ZTogZGVjaW1hbCBkZWdyZWVzIChlZzozNi43KSwgb3B0aW9uYWwsIGRlZmF1bHQgZW1wdHkKICAjICAgbG9uZ2l0dWRlIC0gTG9uZ2l0dWRlCiAgIyAgICAgICAgICAgICAgICAgVmFsdWU6IGRlY2ltYWwgZGVncmVlcyAoZWc6MzYuNyksIG9wdGlvbmFsLCBkZWZhdWx0IGVtcHR5CiAgIyBCb3RoIGxhdGl0dWRlIGFuZCBsb25naXR1ZGUgbXVzdCBiZSBzcGVjaWZpZWQgaWYgdXNlZCwgbm90IGFsbG93IGp1c3Qgc2luZ2xlCiAgIyBvbmUgc3BlY2lmaWVkLCBhbmQgdGhleSB0YWtlIHByZWNlZGVuY2Ugb3ZlciB0aGUgYWRkcmVzcy4KICAjCiAgIyBjb250YWN0IC0gICBDb250YWN0IGluZm8sIHVzZWQgcHJpbWFyaWx5IGZvciBub3RpZmljYXRpb25zLgogICMgICAgICAgICAgICAgVGhpcyBzZWN0aW9uIGlzIHJlcXVpcmVkLgogICMgICAgICAgICAgICAgQ29udGFjdCBjb21wcmlzZXMgdGhlIGZvbGxvd2luZyBrZXkvdmFsdWUgcGFpcnM6CiAgIyAgIG5hbWUgIC0gICAgICAgQ29udGFjdCBuYW1lCiAgIyAgICAgICAgICAgICAgICAgICBWYWx1ZTogYW55IHN0cmluZywgb3B0aW9uYWwsIGRlZmF1bHQgZW1wdHkKICAjICAgZW1haWwgLSAgICAgICBDb250YWN0IGVtYWlsCiAgIyAgICAgICAgICAgICAgICAgICBWYWx1ZTogYW55IHN0cmluZywgb3B0aW9uYWwsIGRlZmF1bHQgZW1wdHkKICAjICAgcGhvbmVOdW1iZXIgLSBDb250YWN0IHBob25lIG51bWJlcgogICMgICAgICAgICAgICAgICAgICAgVmFsdWU6IGFueSBzdHJpbmcsIG9wdGlvbmFsLCBkZWZhdWx0IGVtcHR5CiAgIwogICMgUG9zdC1hcHByb3ZhbCBiZWhhdmlvcjogcmVwbGFjZQphcHBsaWFuY2VJbmZvOgogIHNvZnR3YXJlVmVyc2lvbjogIjguMy4wLjNfODQyOTMiCiAgaG9zdG5hbWU6IGVjdjEtdGVzdAogIGdyb3VwOiBQcmVjb25maWdUZXN0aW5nCiAgc2l0ZTogCiAgbmV0d29ya1JvbGU6IG5vbi1odWIKICByZWdpb246CiAgbG9jYXRpb246CiAgICBhZGRyZXNzOiAKICAgIGFkZHJlc3MyOgogICAgY2l0eTogRm9ydCBDb2xsaW5zCiAgICBzdGF0ZTogQ29sb3JhZG8KICAgIHppcENvZGU6IDgwNTI1CiAgICBjb3VudHJ5OiBVUwogICAgbGF0aXR1ZGU6IAogICAgbG9uZ2l0dWRlOiAKICBjb250YWN0OgogICAgbmFtZTogCiAgICBlbWFpbDogCiAgICBwaG9uZU51bWJlcjoKIyBlbmQgb2YgYXBwbGlhbmNlIGluZm8KCiMgVGVtcGxhdGUgZ3JvdXBzIHRvIGFzc29jaWF0ZSB3aXRoIGFwcGxpYW5jZS4KIyBJZiBubyB0ZW1wbGF0ZXMgbmVlZGVkLCByZW1vdmUgdGhpcyBzZWN0aW9uCiAgIyBncm91cHMgLSAgbGlzdCBvZiB0ZW1wbGF0ZSBncm91cHMuCiAgIyAgICAgICAgICAgb3JkZXIgb2YgdGhlIGxpc3QgZG9lc24ndCBtYXR0ZXIgYXMgT3JjaGVzdHJhdG9yCiAgIyAgICAgICAgICB3aWxsIGRlY2lkZSB0ZW1wbGF0ZXMgYXBwbGljYXRpb24gb3JkZXIKICAjICAgICAgICAgIFZhbHVlOiBsaXN0IG9mIHRlbXBsYXRlIGdyb3VwcyBuYW1lcwogICMKICAjIFBvc3QtYXBwcm92YWwgYmVoYXZpb3I6IHJlcGxhY2UKdGVtcGxhdGVHcm91cHM6CiAgZ3JvdXBzOgogICAgLSBEZWZhdWx0IFRlbXBsYXRlIEdyb3VwCiMgZW5kIG9mIHRlbXBsYXRlIGdyb3VwCgojIFByZWNvbmZpZ3VyYXRpb24gVGVtcGxhdGUgZm9yIGFzc29jaWF0aW5nIEJ1c2luZXNzIEludGVudCBPdmVybGF5cwogICMgb3ZlcmxheXMgLSBsaXN0IG9mIG92ZXJsYXlzIHRvIGJlIGFwcGxpZWQgdG8gYXBwbGlhbmNlLAogICMgICAgICAgICAgICAgT3ZlcmxheXMgbXVzdCBiZSBhbHJlYWR5IGRlZmluZWQgaW4gT3JjaGVzdHJhdG9yCiAgIyAgICAgICAgICAgICBWYWx1ZTogbGlzdCBvZiBvdmVybGF5cyBuYW1lcwogICMKICAjIFBvc3QtYXBwcm92YWwgYmVoYXZpb3I6IG1lcmdlCmJ1c2luZXNzSW50ZW50T3ZlcmxheXM6CiAgICBvdmVybGF5czoKICAgICAgLSBXb3JrCiAgICAgIC0gQ3JpdGljYWxBcHBzCiAgICAgIC0gR2FtaW5nCiAgICAgIC0gUmVhbFRpbWUKICAgICAgLSBEZWZhdWx0T3ZlcmxheQojIGVuZCBvZiBCdXNpbmVzcyBJbnRlbnQgT3ZlcmxheXMgc2VjdGlvbgojCiMgCiMgUHJlY29uZmlndXJhdGlvbiBUZW1wbGF0ZSBmb3IgZWNMaWNlbnNpbmcKZWNMaWNlbnNpbmc6CiAgIyB0aGlzIGVjTGljZW5zaW5nIHNlY3Rpb24gaXMgbWFuZGF0b3J5IGZvciBlbnRlcnByaXNlIEVDIGxpY2Vuc2VkIG1vZGVscy4KICAjIEZvciBWWC9OWCBhcHBsaWFuY2VzLCBwbGVhc2UgcmVtb3ZlIHRoZQogICMgd2hvbGUgc2VjdGlvbiBhcyB0aGlzIGlzIG5vdCBuZWVkZWQuCiAgIyBUbyBjb25maWd1cmUgYXBwbGlhbmNlIEVDIGxpY2Vuc2UgYWNjb3VudCBuYW1lL2tleSwKICAjIGVpdGhlciBzZXQgdXNlRGVmYXVsdEVjQWNjb3VudCB0byB0cnVlIHRvIHVzZQogICMgdGhlIGRlZmF1bHQgRUMgYWNjb3VudCB0aGF0IGlzIGNvbmZpZ3VyZWQgb24gdGhlIE9yY2hlc3RyYXRvciwKICAjIG9yIHNldCB1c2VEZWZhdWx0QWNjb3VudCB0byBmYWxzZQogICMgYW5kIHNwZWNpZnkgdGhlIGFjY291bnROYW1lIGFuZCBhY2NvdW50S2V5LgogIHVzZURlZmF1bHRBY2NvdW50OiB0cnVlCgogICMgdW5jb21tZW50IHRoZSBmb2xsb3dpbmcgYW5kIHByb3ZpZGUgYSB2YWxpZCBhY2NvdW50IG5hbWUva2V5CiAgIyBpZiBhYm92ZSB1c2VEZWZhdWx0QWNjb3VudCBpcyBzZXQgdG8gZmFsc2UKICAjIGFjY291bnROYW1lOiA8bmFtZT4KICAjIGFjY291bnRLZXk6IDxrZXk+CgogICMgVGhlcmUgYXJlIHRocmVlIHR5cGVzIG9mIEVDIGxpY2Vuc2VzLCBlYWNoIG9mIHdoaWNoIGVtcGxveXMKICAjIGEgZGlmZmVyZW50IGxpY2Vuc2UgY29uZmlndXJhdGlvbiBzY2hlbWEuCiAgIyBOb3RlOiBiYW5kd2lkdGggdmFsdWUgZm9yIGJhbmR3aWR0aExldmVsIGFuZCBCb29zdAogICMgYXJlIHJlcHJlc2VudCBiaWRpcmVjdGlvbmFsCiAgIyBiYW5kd2lkdGgsIGFuZCBhcHBsaWVzIHRvIGJvdGggaW5ib3VuZCBhbmQgb3V0Ym91bmQgZGlyZWN0aW9ucwoKICAjIGZvciBFQy1FbnRlcnByaXNlIGxpY2Vuc2luZywgYmFuZHdpZHRoIExldmVsIGFuZCBib29zdCBib3RoCiAgIyBuZWVkIHRvIGJlIGNvbmZpZ3VyZWQKICAjCiAgIyBOT1RFIHRoYXQgdGhlIGFsbG93ZWQgdG90YWwgb3V0Ym91bmQgYmFuZHdpZHRoIHdpbGwgYmUgbGltaXRlZCBieSB0aGUKICAjIGJhbmR3aWR0aCBsaWNlbnNlIGN1cnJlbnRseSBpbiBlZmZlY3QuIFNpbXVsdGFuZW91cyBjaGFuZ2VzIHRvIHRvdGFsCiAgIyBvdXRib3VuZCBiYW5kd2lkdGggYW5kIGxpY2Vuc2VkIGJhbmR3aWR0aCBpcyBub3Qgc3VwcG9ydGVkLgogICMgQ2hhbmdpbmcgdGhlIGxpY2Vuc2VkIGJhbmR3aWR0aCB0byBhIG5ldyB2YWx1ZSBzaG91bGQgYmUgZG9uZSBmaXJzdCwKICAjIGJlZm9yZSBjaGFuZ2luZyB0aGUgdG90YWwgb3V0Ym91bmQgYmFuZHdpZHRoCiAgIwogICMgYmFuZHdpZHRoTGV2ZWw6IHZhbGlkIHZhbHVlcyBhcmUgbWluaSwgYmFzZSBvciBwbHVzIG9yLAogICMgICAgYSBiYW5kd2lkdGggdGllciBsZXZlbCAobWluaSwgYmFzZSwgcGx1cykKICAjICAgIGxpY2Vuc2UgdHlwZXMgcmVwcmVzZW50ICg8NTBNYnBzLCA8MjAwTWJwcywgYW5kIDwxVGJwcykgcmVzcGVjdGl2ZWx5LgogICMgICAgcGx1cyBsaWNlbnNpbmcgZW5hYmxlcyBiYW5kd2lkdGggY29uZmlndXJhdGlvbiA+MjAwTWJwcyBhbmQgdXAgdG8gMTBHYnBzLAogICMgICAgc3ViamVjdCB0byBoYXJkd2FyZSBvciBWTSBsaW1pdGF0aW9ucy4KICAjICAgIGJhbmR3aWR0aExldmVsIGNhbiBhbHNvIGJlIHVzZWQgdG8gc3BlY2lmeSBlbnRlcnByaXNlIGJhbmR3aWR0aCB0aWVycy4KICAjICAgIFZhbGlkIHZhbHVlcyBpbmNsdWRlCiAgIyAgICB7NTAwMDAsIDIwMDAwMCwgNTAwMDAwLCAxMDAwMDAwLCAyMDAwMDAwLCB1bmxpbWl0ZWR9IChrYnBzKQogICMgICAgd2hpY2ggcmVwcmVzZW50IDUwTSwgMjAwTSwgNTAwTSwgMUcsIDJHLCBhbmQgMVQsCiAgIyAgICBzdWJqZWN0IHRvIGhhcmR3YXJlIG9yIFZNIGxpbWl0YXRpb25zLgogICMKICAjIGJvb3N0OiB2YWxpZCB2YWx1ZSBpcyBiZXR3ZWVuIDAgdG8gMTAwMDAwMDAgKGticHMpCiAgIyBFeGFtcGxlIC0gRW50ZXJwcmlzZSB3aXRoICdCYXNlJyBiYW5kd2lkdGhMZXZlbCBhbmQgMTAwMDAwS2JwcyBCb29zdAogICMgICAgICAgICAgIGJhbmR3aWR0aAogICMgYmFuZHdpZHRoTGV2ZWw6IGJhc2UKICAjIGJvb3N0OiAxMDAwMDAKCiAgIyBmb3Igc2VydmljZSBwcm92aWRlciBFQy1UZXJtIGxpY2Vuc2luZywgdGhlIHNlcmlhbCBudW1iZXIgb2YgdGhlIGxpY2Vuc2UKICAjIG5lZWRzIHRvIGJlIGNvbmZpZ3VyZWQKICAjICAgICBsaWNlbnNlU2VyaWFsOiA8c2VyaWFsIG51bWJlciBmb3IgbGljZW5zZSBhc3NldD4KICAjIEV4YW1wbGUgLSBUZXJtIGxpY2Vuc2Ugc2VyaWFsIG51bWJlciBhc3NpZ25tZW50CiAgIyBsaWNlbnNlU2VyaWFsOiA8dG8tYmUtYWRkZWQtd2l0aC1yZWFsLXNlcmlhbD8/PgoKICAjIGZvciBzZXJ2aWNlIHByb3ZpZGVyIEVDLU1ldGVyZWQgbGljZW5zaW5nLCB0aGUgbWF4IHN5c3RlbSBiYW5kd2lkdGgKICAjIG5lZWRzIHRvIGJlIGNvbmZpZ3VyZWQsIHJlcHJlc2VudGluZyB0aGUgbWV0ZXJlZCBiYW5kd2lkdGggbGV2ZWwuCiAgIyBCb29zdCBiYW5kd2lkdGggY2FuIGJlIGNvbmZpZ3VyZWQgaGVyZSB2aWEgdGhlICdib29zdCcga2V5d29yZAogICMgICAgYm9vc3Q6IHZhbGlkIHZhbHVlIGlzIGJldHdlZW4gMCB0byA1MDAwMDAwMCAoS2JwcykKICAjIEV4YW1wbGUgLSBNZXRlcmVkIHdpdGggNTAwMDBLYnBzIGJvb3N0IGJhbmR3aWR0aAogICMgYm9vc3Q6IDUwMDAwCgogICMgIHRoZSBmb2xsb3dpbmcgaXMgYW4gdW5jb21tZW50ZWQgZXhhbXBsZSBvZiBFQy1FbnRlcnByaXNlIGxpY2Vuc2luZwogIGJhbmR3aWR0aExldmVsOiBiYXNlCiAgYm9vc3Q6IDAKICAjCiAgIyhwZXJmb3JtICJyZXBsYWNlIiBvcGVyYXRpb24gd2hlbmV2ZXIgYXBwbGllZCkKIyBlbmQgb2YgZWNMaWNlbnNpbmcKIwojIGVuZCBvZiBjb25maWc='

    preconfigUpload(orchIP, loginCookie, name, tag, data)

# end
